<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JRÁ¶èÂ±±ÈßÖ„Åã„Çâ„Éà„É®„Çø„É¨„É≥„Çø„Ç´„ÉºÁ¶èÂ±±ÈßÖÂâçÂ∫ó Ê°àÂÜÖ„Éû„ÉÉ„Éó</title>
    <style>
        @page {
            size: A4;
            margin: 20mm;
        }
        body {
            font-family: "Helvetica Neue", Arial, "Hiragino Sans", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
            margin: 0;
            padding: 20px;
            background: white;
            line-height: 1.6;
        }
        .container {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
        }
        .header {
            text-align: center;
            border-bottom: 3px solid #00A040;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }
        .header h1 {
            color: #00A040;
            font-size: 24px;
            margin: 0 0 10px 0;
            font-weight: bold;
        }
        .header p {
            color: #666;
            font-size: 14px;
            margin: 5px 0;
        }
        .map-container {
            position: relative;
            width: 100%;
            height: 420px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
            background: #f8f9fa;
            overflow: hidden;
        }
        .route-info {
            display: flex;
            flex-direction: row;
            gap: 20px;
            margin: 20px 0;
        }
        .route-steps {
            flex: 1;
            background: #f0f8ff;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #0066cc;
        }
        .route-steps h3 {
            color: #0066cc;
            margin: 0 0 15px 0;
            font-size: 18px;
            display: flex;
            align-items: center;
        }
        .route-steps h3::before {
            content: "üö∂‚Äç‚ôÇÔ∏è";
            margin-right: 8px;
            font-size: 20px;
        }
        .step {
            margin: 12px 0;
            display: flex;
            align-items: flex-start;
        }
        .step-number {
            background: #0066cc;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            margin-right: 12px;
            flex-shrink: 0;
        }
        .step-text {
            font-size: 14px;
            color: #333;
        }
        .landmark {
            color: #000000;
            font-weight: bold;
        }
        .shop-info {
            flex: 1;
            background: #f0f9f4;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #00A040;
        }
        .shop-info h3 {
            color: #00A040;
            margin: 0 0 15px 0;
            font-size: 18px;
            display: flex;
            align-items: center;
        }
        .shop-info h3::before {
            content: "üè¢";
            margin-right: 8px;
            font-size: 20px;
        }
        .info-item {
            margin: 8px 0;
            font-size: 14px;
        }
        .info-label {
            font-weight: bold;
            color: #666;
            display: inline-block;
            width: 80px;
        }
        .alert-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #856404;
        }
        .alert-box h4 {
            margin: 0 0 10px 0;
            color: #856404;
            display: flex;
            align-items: center;
        }
        .alert-box h4::before {
            content: "‚ö†Ô∏è";
            margin-right: 8px;
        }
        .static-map {
            position: relative;
            width: 100%;
            height: 100%;
        }
        .map-controls-overlay {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .map-control-btn {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            backdrop-filter: blur(5px);
        }
        .map-control-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .map-control-btn.primary {
            background: rgba(0, 102, 204, 0.95);
            color: white;
            border-color: #0066cc;
        }
        .map-control-btn.primary:hover {
            background: #0066cc;
        }
        .map-control-btn.secondary {
            background: rgba(230, 0, 18, 0.95);
            color: white;
            border-color: #e60012;
        }
        .map-control-btn.secondary:hover {
            background: #e60012;
        }
        .interactive-map {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .interactive-controls {
            display: flex;
            gap: 8px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 0 0 6px 6px;
            align-items: center;
            flex-wrap: wrap;
            flex-shrink: 0;
            min-height: 80px;
            overflow: visible;
        }
        .address-input {
            flex: 1;
            min-width: 150px;
            max-width: 200px;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }
        .address-input:focus {
            outline: none;
            border-color: #00A040;
            box-shadow: 0 0 0 2px rgba(0, 160, 64, 0.1);
        }
        .distance-time {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            margin: 15px 0;
            border: 1px solid #ddd;
        }
        .distance-time strong {
            color: #333333;
            font-size: 16px;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #666;
            font-size: 12px;
        }
        
        /* „Çπ„Éû„ÉõÂ∞ÇÁî®„Çπ„Çø„Ç§„É´ */
        @media screen and (max-width: 768px) {
            .route-info {
                flex-direction: column;
                gap: 15px;
            }
            .route-steps,
            .shop-info {
                flex: none;
                width: 100%;
            }
            .interactive-controls {
                flex-direction: column;
                align-items: stretch;
                min-height: 200px;
                gap: 8px;
                padding: 15px;
                overflow: visible;
            }
            .map-control-btn {
                width: 100%;
                text-align: center;
                padding: 12px 16px;
                font-size: 14px;
                margin-bottom: 5px;
                box-sizing: border-box;
            }
            .address-input {
                width: 100%;
                max-width: none;
                margin-bottom: 8px;
                padding: 10px 12px;
                box-sizing: border-box;
            }
            .map-container {
                height: 480px;
            }
            #googleMap {
                height: 280px !important;
            }
            .interactive-map {
                height: 100%;
            }
        }
        
        @media print {
            .map-controls-overlay,
            .interactive-controls {
                display: none;
            }
            #interactiveMap {
                display: none !important;
            }
            #staticMap {
                display: block !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>„Éà„É®„Çø„É¨„É≥„Çø„Ç´„ÉºÁ¶èÂ±±ÈßÖÂâçÂ∫ó „ÅîÊù•Â∫óÊ°àÂÜÖ</h1>
            <p>JRÁ¶èÂ±±ÈßÖÂçóÂè£„Åã„ÇâÂæíÊ≠©Á¥Ñ5ÂàÜ</p>
            <p>„Äí720-0066 Â∫ÉÂ≥∂ÁúåÁ¶èÂ±±Â∏Ç‰∏â‰πã‰∏∏Áî∫7-20</p>
        </div>

        <div class="distance-time">
            <strong>üìç JRÁ¶èÂ±±ÈßÖÂçóÂè£ ‚Üí „Éà„É®„Çø„É¨„É≥„Çø„Ç´„ÉºÁ¶èÂ±±ÈßÖÂâçÂ∫ó</strong><br>
            <strong>ÂæíÊ≠©Á¥Ñ5ÂàÜÔºàÁ¥Ñ400mÔºâ</strong>
        </div>

        <div class="map-container">
            <!-- Static Map (ÂàùÊúüË°®Á§∫) -->
            <div id="staticMap" class="static-map">
                <img id="staticMapImage" 
                     src="" 
                     alt="JRÁ¶èÂ±±ÈßÖ„Åã„Çâ„Éà„É®„Çø„É¨„É≥„Çø„Ç´„ÉºÁ¶èÂ±±ÈßÖÂâçÂ∫ó„Å∏„ÅÆ„É´„Éº„Éà„Éû„ÉÉ„Éó" 
                     style="width: 100%; height: 100%; object-fit: cover; border-radius: 6px;">
                
                <!-- Loading indicator -->
                <div id="mapLoading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255,255,255,0.9); padding: 20px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 18px; color: #00A040; margin-bottom: 10px;">üìç</div>
                    <div style="color: #666;">ÊúÄÈÅ©„Å™„É´„Éº„Éà„ÇíË®àÁÆó‰∏≠...</div>
                </div>
                
                <!-- Map Controls Overlay -->
                <div class="map-controls-overlay">
                    <button onclick="activateInteractiveMap()" class="map-control-btn primary">
                        üó∫Ô∏è „Éû„ÉÉ„Éó„ÇíÊìç‰Ωú„Åô„Çã
                    </button>
                    <button onclick="openGoogleMapsNavi()" class="map-control-btn secondary">
                        üì± ÁèæÂú®Âú∞„Åã„Çâ„Éä„Éì
                    </button>
                </div>
            </div>

            <!-- Interactive Map (Âàá„ÇäÊõø„ÅàÂæå) -->
            <div id="interactiveMap" class="interactive-map" style="display: none;">
                <div id="googleMap" style="width: 100%; height: 350px; border-radius: 6px 6px 0 0; flex-grow: 1;"></div>
                <div class="interactive-controls">
                    <button onclick="showStaticMap()" class="map-control-btn">
                        ‚Üê ÂÖÉ„ÅÆË°®Á§∫„Å´Êàª„Çã
                    </button>
                    <input type="text" id="startAddress" placeholder="Âá∫Áô∫Âú∞„ÇíÂÖ•ÂäõÔºà‰æãÔºöÂ∫ÉÂ≥∂ÈßÖÔºâ" class="address-input">
                    <button onclick="calculateCustomRoute()" class="map-control-btn primary">
                        üîç „É´„Éº„ÉàÊ§úÁ¥¢
                    </button>
                    <button onclick="openGoogleMapsNavi()" class="map-control-btn secondary">
                        üì± Google„Éû„ÉÉ„Éó„ÅßÈñã„Åè
                    </button>
                </div>
            </div>
        </div>

        <div class="route-info">
            <div class="route-steps">
                <h3>ÂæíÊ≠©„É´„Éº„Éà</h3>
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-text">JRÁ¶èÂ±±ÈßÖ<strong>ÂçóÂè£</strong>„Åã„ÇâÂá∫„Çã</div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-text"><strong>Âè≥ÊñπÂêë</strong>Ôºà‰πùÂ∑ûÊñπÂêëÔºâ„Å´ÈÄ≤„ÇÄ</div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-text"><span class="landmark">„ÉÄ„Ç§„ÉØ„É≠„Ç§„Éç„ÉÉ„Éà„Éõ„ÉÜ„É´</span>„ÅÆÊâãÂâç„Åæ„Åü„ÅØÂ••„Åß<strong>Â∑¶Êäò</strong>„Åó„Å¶Ë∑ØÂú∞„Å∏ÂÖ•„Çã</div>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <div class="step-text">Á™Å„ÅçÂΩì„Åü„Å£„Åü„Çâ<strong>Âè≥„Å´Êõ≤„Åå„Çä</strong>Áõ¥ÈÄ≤</div>
                </div>
                <div class="step">
                    <div class="step-number">5</div>
                    <div class="step-text"><strong>Â∑¶Êâã</strong>„Å´„Éà„É®„Çø„É¨„É≥„Çø„Ç´„ÉºÁ¶èÂ±±ÈßÖÂâçÂ∫ó</div>
                </div>
            </div>

            <div class="shop-info">
                <h3>Â∫óËàóÊÉÖÂ†±</h3>
                <div class="info-item">
                    <span class="info-label">Â∫óËàóÂêçÔºö</span>„Éà„É®„Çø„É¨„É≥„Çø„Ç´„ÉºÁ¶èÂ±±ÈßÖÂâçÂ∫ó
                </div>
                <div class="info-item">
                    <span class="info-label">‰ΩèÊâÄÔºö</span>„Äí720-0066<br>„ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄÂ∫ÉÂ≥∂ÁúåÁ¶èÂ±±Â∏Ç‰∏â‰πã‰∏∏Áî∫7-20
                </div>
                <div class="info-item">
                    <span class="info-label">ÈõªË©±Ôºö</span>084-973-0100
                </div>
                <div class="info-item">
                    <span class="info-label">Âñ∂Ê•≠ÊôÇÈñìÔºö</span>8:00ÔΩû20:00ÔºàÂπ¥‰∏≠ÁÑ°‰ºëÔºâ
                </div>
                <div class="info-item">
                    <span class="info-label">ÂæíÊ≠©ÊôÇÈñìÔºö</span>JRÁ¶èÂ±±ÈßÖÂçóÂè£„Åã„ÇâÁ¥Ñ5ÂàÜÔºàÁ¥Ñ400mÔºâ
                </div>
            </div>
        </div>

        <div class="alert-box">
            <h4>„ÅîÊù•Â∫óÊôÇ„ÅÆ„ÅîÊ≥®ÊÑè</h4>
            <p><strong>ÁúãÊùø„ÅåË¶ã„Åà„Å´„Åè„ÅÑÁ´ãÂú∞„ÅÆ„Åü„ÇÅ„ÄÅ‰ª•‰∏ã„Çí„ÅîÊ¥ªÁî®„Åè„Å†„Åï„ÅÑÔºö</strong></p>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li>„Çπ„Éû„Éº„Éà„Éï„Ç©„É≥„ÅÆÂú∞Âõ≥„Ç¢„Éó„É™„Å®‰ΩµÁî®„Åó„Å¶„ÅäË∂ä„Åó„Åè„Å†„Åï„ÅÑ</li>
                <li>Â∫óËàó„Å´Ëøë„Å•„Åë„Å∞„Éà„É®„Çø„É¨„É≥„Çø„Ç´„Éº„ÅÆÁúãÊùø„ÅåË¶ã„Åà„Åæ„Åô</li>
                <li>Ëø∑„Çè„Çå„ÅüÂ†¥Âêà„ÅØÂ∫óËàóÔºà084-973-0100Ôºâ„Åæ„Åß„ÅäÈõªË©±„Åè„Å†„Åï„ÅÑ</li>
            </ul>
        </div>

        <div class="footer">
            <p>„Åì„ÅÆ„Éû„ÉÉ„Éó„ÅØÊù•Â∫óÊ°àÂÜÖÁî®„Åß„Åô„ÄÇÊúÄÊñ∞„ÅÆÂñ∂Ê•≠ÊôÇÈñìÁ≠â„ÅØÂ∫óËàó„Å´„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
            <p>„ÅäËªä„Åß„ÅäË∂ä„Åó„ÅÆÂ†¥Âêà„ÅØ„ÄÅÂ∫óËàó„Åæ„Åß„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
        </div>
    </div>

    <!-- Google Maps JavaScript API -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAGUorGUfy--oERdupd_6FoUQc-xFR5WbE&libraries=geometry,places&callback=initMap"></script>
    
    <script>
        // Â∫óËàó„ÅÆÂ∫ßÊ®ô
        const SHOP_LOCATION = { lat: 34.4875, lng: 133.3601 };
        const STATION_LOCATION = { lat: 34.489004912054284, lng: 133.3624000319858 };
        
        let map;
        let directionsService;
        let directionsRenderer;

        // Google MapsÂàùÊúüÂåñ
        function initMap() {
            // „Éû„ÉÉ„Éó‰ΩúÊàêÔºàÂàùÊúü„ÅØÈùûË°®Á§∫Ôºâ
            map = new google.maps.Map(document.getElementById('googleMap'), {
                zoom: 17,
                center: SHOP_LOCATION,
                mapTypeId: 'roadmap'
            });

            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({
                polylineOptions: {
                    strokeColor: '#0066cc',
                    strokeWeight: 4
                }
            });
            directionsRenderer.setMap(map);

            // ÈùôÁöÑ„Éû„ÉÉ„ÉóÁî®„ÅÆÂÆüÈöõ„ÅÆ„É´„Éº„Éà„ÇíÂèñÂæó
            generateStaticMapWithRoute();

            // „Éá„Éï„Ç©„É´„Éà„É´„Éº„Éà„ÇíË®≠ÂÆö
            calculateRoute(STATION_LOCATION, SHOP_LOCATION);
        }

        // ÂÆüÈöõ„ÅÆÂæíÊ≠©„É´„Éº„Éà„ÇíÂèñÂæó„Åó„Å¶ÈùôÁöÑ„Éû„ÉÉ„Éó„ÇíÁîüÊàê
        function generateStaticMapWithRoute() {
            const request = {
                origin: STATION_LOCATION,
                destination: SHOP_LOCATION,
                travelMode: google.maps.TravelMode.WALKING,
                unitSystem: google.maps.UnitSystem.METRIC,
                avoidHighways: false,
                avoidTolls: false
            };

            directionsService.route(request, (result, status) => {
                if (status === 'OK') {
                    console.log('Route calculation successful');
                    console.log('Full result structure:', result);
                    
                    const route = result.routes[0];
                    console.log('Route object:', route);
                    console.log('Overview polyline object:', route.overview_polyline);
                    
                    let encodedPath = null;
                    
                    // „Çà„ÇäË©≥Á¥∞„Å™„Éù„É™„É©„Ç§„É≥ÂèñÂæó
                    if (route && route.overview_polyline && route.overview_polyline.points) {
                        encodedPath = route.overview_polyline.points;
                        console.log('Successfully got encoded polyline:', encodedPath.substring(0, 50) + '...');
                    } else {
                        console.log('Trying alternative polyline access methods...');
                        
                        // ‰ª£ÊõøÊâãÊÆµ1: legs „Åã„ÇâË©≥Á¥∞„Éù„Ç§„É≥„Éà„ÇíÂèñÂæó
                        if (route.legs && route.legs.length > 0) {
                            const steps = route.legs[0].steps;
                            const waypoints = [];
                            
                            steps.forEach(step => {
                                waypoints.push(`${step.start_location.lat()},${step.start_location.lng()}`);
                                waypoints.push(`${step.end_location.lat()},${step.end_location.lng()}`);
                            });
                            
                            encodedPath = waypoints.join('|');
                            console.log('Created waypoint path from steps:', waypoints.length, 'points');
                        } else {
                            console.log('No legs available, using manual path');
                            encodedPath = createEnhancedManualPath();
                        }
                    }
                    
                    // ÈùôÁöÑ„Éû„ÉÉ„ÉóURL„ÇíÊßãÁØâ
                    const staticMapUrl = buildStaticMapUrl(encodedPath);
                    console.log('Final static map URL:', staticMapUrl);
                    
                    // ÈùôÁöÑ„Éû„ÉÉ„Éó„ÇíÊõ¥Êñ∞
                    const mapImage = document.getElementById('staticMapImage');
                    const loadingDiv = document.getElementById('mapLoading');
                    
                    mapImage.onload = function() {
                        loadingDiv.style.display = 'none';
                        console.log('Static map loaded successfully with route');
                    };
                    
                    mapImage.onerror = function() {
                        console.error('Failed to load static map image');
                        showFallbackStaticMap();
                    };
                    
                    mapImage.src = staticMapUrl;
                } else {
                    console.error('Direction service failed with status:', status);
                    showFallbackStaticMap();
                }
            });
        }

        // „Çà„ÇäË©≥Á¥∞„Å™ÊâãÂãï„Éë„Çπ‰ΩúÊàê
        function createEnhancedManualPath() {
            // Á¶èÂ±±ÈßÖ„Åã„ÇâÂ∫óËàó„Åæ„Åß„ÅÆÂÆüÈöõ„ÅÆÈÅìË∑Ø„Å´Ê≤ø„Å£„ÅüÊé®ÂÆö„É´„Éº„Éà
            const detailedPoints = [
                `${STATION_LOCATION.lat},${STATION_LOCATION.lng}`, // Á¶èÂ±±ÈßÖÂçóÂè£
                '34.4888,133.3620', // ÈßÖÂâçÂ∫ÉÂ†¥
                '34.4886,133.3615', // Âçó„Å∏ÈÄ≤„ÇÄ
                '34.4884,133.3610', // „É≠„Éº„ÇΩ„É≥ÊâãÂâç
                '34.4882,133.3608', // „É≠„Éº„ÇΩ„É≥‰ΩçÁΩÆÔºàÂè≥ÊäòÂú∞ÁÇπÔºâ
                '34.4880,133.3605', // Âè≥ÊäòÂæå
                '34.4878,133.3603', // Áõ¥ÈÄ≤
                `${SHOP_LOCATION.lat},${SHOP_LOCATION.lng}` // „Éà„É®„Çø„É¨„É≥„Çø„Ç´„Éº
            ];
            
            console.log('Created enhanced manual path with', detailedPoints.length, 'points');
            return detailedPoints.join('|');
        }

        // ÈùôÁöÑ„Éû„ÉÉ„ÉóURL„ÇíÊßãÁØâ
        function buildStaticMapUrl(pathData) {
            const baseUrl = 'https://maps.googleapis.com/maps/api/staticmap';
            const size = '600x400';
            const mapType = 'roadmap';
            const zoom = '16';
            const apiKey = 'AIzaSyAGUorGUfy--oERdupd_6FoUQc-xFR5WbE';
            
            // „Éû„Éº„Ç´„ÉºË®≠ÂÆö - ÈßÖ„ÅØÈùí„ÄÅÂ∫óËàó„ÅØ„Éà„É®„Çø„Ç∞„É™„Éº„É≥
            const startMarker = `markers=color:blue%7Clabel:S%7C${STATION_LOCATION.lat},${STATION_LOCATION.lng}`;
            const endMarker = `markers=color:0x00A040%7Clabel:G%7C${SHOP_LOCATION.lat},${SHOP_LOCATION.lng}`;
            
            // „Éë„ÇπË®≠ÂÆö
            let pathParam;
            if (pathData && pathData.includes('|')) {
                // ÊâãÂãï„Éë„ÇπÔºàÂ∫ßÊ®ô„É™„Çπ„ÉàÔºâ
                pathParam = `path=color:0x0066ccff%7Cweight:5%7C${pathData}`;
            } else if (pathData) {
                // „Ç®„É≥„Ç≥„Éº„Éâ„Åï„Çå„Åü„Éù„É™„É©„Ç§„É≥
                pathParam = `path=color:0x0066ccff%7Cweight:5%7Cenc:${pathData}`;
            } else {
                // Áõ¥Á∑ö„Éë„ÇπÔºàÊúÄÁµÇÊâãÊÆµÔºâ
                pathParam = `path=color:0x0066ccff%7Cweight:5%7C${STATION_LOCATION.lat},${STATION_LOCATION.lng}%7C${SHOP_LOCATION.lat},${SHOP_LOCATION.lng}`;
            }
            
            const fullUrl = `${baseUrl}?size=${size}&maptype=${mapType}&zoom=${zoom}&${startMarker}&${endMarker}&${pathParam}&key=${apiKey}`;
            
            return fullUrl;
        }

        // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÁî®„ÅÆÈùôÁöÑ„Éû„ÉÉ„Éó
        function showFallbackStaticMap() {
            const mapImage = document.getElementById('staticMapImage');
            const loadingDiv = document.getElementById('mapLoading');
            
            mapImage.src = `https://maps.googleapis.com/maps/api/staticmap?size=600x400&maptype=roadmap&markers=color:blue%7Clabel:S%7C${STATION_LOCATION.lat},${STATION_LOCATION.lng}&markers=color:0x00A040%7Clabel:G%7C${SHOP_LOCATION.lat},${SHOP_LOCATION.lng}&zoom=16&key=AIzaSyAGUorGUfy--oERdupd_6FoUQc-xFR5WbE`;
            
            loadingDiv.innerHTML = '<div style="color: #00A040;">„Éû„ÉÉ„Éó„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>';
            setTimeout(() => {
                loadingDiv.style.display = 'none';
            }, 2000);
        }

        // „Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„Éû„ÉÉ„Éó„ÇíË°®Á§∫
        function activateInteractiveMap() {
            document.getElementById('staticMap').style.display = 'none';
            document.getElementById('interactiveMap').style.display = 'block';
            
            // „Éû„ÉÉ„Éó„Çµ„Ç§„Ç∫Ë™øÊï¥
            setTimeout(() => {
                google.maps.event.trigger(map, 'resize');
                map.setCenter(SHOP_LOCATION);
            }, 100);
        }

        // ÈùôÁöÑ„Éû„ÉÉ„Éó„Å´Êàª„Çã
        function showStaticMap() {
            document.getElementById('staticMap').style.display = 'block';
            document.getElementById('interactiveMap').style.display = 'none';
        }

        // „É´„Éº„ÉàË®àÁÆó
        function calculateRoute(start, end) {
            const request = {
                origin: start,
                destination: end,
                travelMode: google.maps.TravelMode.WALKING
            };

            directionsService.route(request, (result, status) => {
                if (status === 'OK') {
                    directionsRenderer.setDirections(result);
                } else {
                    console.error('„É´„Éº„ÉàË®àÁÆó„Ç®„É©„Éº:', status);
                }
            });
        }

        // „Ç´„Çπ„Çø„É†„É´„Éº„ÉàÊ§úÁ¥¢
        function calculateCustomRoute() {
            const startAddress = document.getElementById('startAddress').value;
            if (!startAddress.trim()) {
                alert('Âá∫Áô∫Âú∞„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            const geocoder = new google.maps.Geocoder();
            geocoder.geocode({ address: startAddress }, (results, status) => {
                if (status === 'OK') {
                    const startLocation = results[0].geometry.location;
                    calculateRoute(startLocation, SHOP_LOCATION);
                } else {
                    alert('‰ΩèÊâÄ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇÊ≠£„Åó„ÅÑ‰ΩèÊâÄ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                }
            });
        }

        // ÁèæÂú®Âú∞ÂèñÂæó„Åó„Å¶„Éä„ÉìÈñãÂßã
        function openGoogleMapsNavi() {
            // „Çπ„Éû„Éõ„Åß„ÅÆ‰ΩçÁΩÆÊÉÖÂ†±ÂèñÂæó„ÇíÊîπÂñÑ
            if (navigator.geolocation) {
                // È´òÁ≤æÂ∫¶„Å™‰ΩçÁΩÆÊÉÖÂ†±ÂèñÂæó„Ç™„Éó„Ç∑„Éß„É≥
                const geoOptions = {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                };
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        // „Çπ„Éû„ÉõÁî®„ÅÆGoogle„Éû„ÉÉ„ÉóURLÔºà„Çà„ÇäÁ¢∫ÂÆü„Å™ÊñπÊ≥ïÔºâ
                        const googleMapsUrl = `https://www.google.com/maps/dir/?api=1&origin=${lat},${lng}&destination=${SHOP_LOCATION.lat},${SHOP_LOCATION.lng}&travelmode=walking`;
                        
                        console.log('Opening navigation with current location:', lat, lng);
                        
                        // „Çπ„Éû„Éõ„Åß„Ç¢„Éó„É™„ÅåÈñã„Åè„Çà„ÅÜ„Å´Ë™øÊï¥
                        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                            // „É¢„Éê„Ç§„É´„Éá„Éê„Ç§„Çπ„ÅÆÂ†¥Âêà
                            window.location.href = googleMapsUrl;
                        } else {
                            // PC„ÅÆÂ†¥Âêà
                            window.open(googleMapsUrl, '_blank');
                        }
                    },
                    (error) => {
                        console.error('Geolocation error:', error);
                        
                        // ÁèæÂú®Âú∞ÂèñÂæóÂ§±ÊïóÊôÇ„ÅØÈßÖ„Åã„Çâ„ÅÆ„É´„Éº„Éà„ÇíË°®Á§∫
                        const fallbackUrl = `https://www.google.com/maps/dir/?api=1&origin=${STATION_LOCATION.lat},${STATION_LOCATION.lng}&destination=${SHOP_LOCATION.lat},${SHOP_LOCATION.lng}&travelmode=walking`;
                        
                        // „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
                        alert('ÁèæÂú®Âú∞„ÇíÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇÈßÖ„Åã„Çâ„ÅÆ„É´„Éº„Éà„ÇíË°®Á§∫„Åó„Åæ„Åô„ÄÇ');
                        
                        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                            window.location.href = fallbackUrl;
                        } else {
                            window.open(fallbackUrl, '_blank');
                        }
                    },
                    geoOptions
                );
            } else {
                console.log('Geolocation not supported');
                
                // ‰ΩçÁΩÆÊÉÖÂ†±ÈùûÂØæÂøú„ÅÆÂ†¥Âêà„ÅØÈßÖ„Åã„Çâ„ÅÆ„É´„Éº„Éà„ÇíË°®Á§∫
                const fallbackUrl = `https://www.google.com/maps/dir/?api=1&origin=${STATION_LOCATION.lat},${STATION_LOCATION.lng}&destination=${SHOP_LOCATION.lat},${SHOP_LOCATION.lng}&travelmode=walking`;
                
                alert('„Åä‰Ωø„ÅÑ„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØ‰ΩçÁΩÆÊÉÖÂ†±„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÈßÖ„Åã„Çâ„ÅÆ„É´„Éº„Éà„ÇíË°®Á§∫„Åó„Åæ„Åô„ÄÇ');
                
                if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                    window.location.href = fallbackUrl;
                } else {
                    window.open(fallbackUrl, '_blank');
                }
            }
        }

        // Âç∞Âà∑Áî®„Å´ÈùôÁöÑ„Éû„ÉÉ„Éó„ÇíÂº∑Âà∂Ë°®Á§∫
        window.addEventListener('beforeprint', () => {
            showStaticMap();
        });
    </script>
</body>
</html>