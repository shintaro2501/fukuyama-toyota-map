<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JRç¦å±±é§…ã‹ã‚‰ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ç¦å±±é§…å‰åº— æ¡ˆå†…ãƒãƒƒãƒ—</title>
    <style>
        @page {
            size: A4;
            margin: 20mm;
        }
        body {
            font-family: "Helvetica Neue", Arial, "Hiragino Sans", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
            margin: 0;
            padding: 20px;
            background: white;
            line-height: 1.6;
        }
        .container {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
        }
        .header {
            text-align: center;
            border-bottom: 3px solid #00A040;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }
        .header h1 {
            color: #00A040;
            font-size: 24px;
            margin: 0 0 10px 0;
            font-weight: bold;
        }
        .header p {
            color: #666;
            font-size: 14px;
            margin: 5px 0;
        }
        .map-container {
            position: relative;
            width: 100%;
            height: 420px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
            background: #f8f9fa;
            overflow: hidden;
        }
        .route-info {
            display: flex;
            flex-direction: row;
            gap: 20px;
            margin: 20px 0;
        }
        .route-steps {
            flex: 1;
            background: #f0f8ff;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #0066cc;
        }
        .route-steps h3 {
            color: #0066cc;
            margin: 0 0 15px 0;
            font-size: 18px;
            display: flex;
            align-items: center;
        }
        .route-steps h3::before {
            content: "ğŸš¶â€â™‚ï¸";
            margin-right: 8px;
            font-size: 20px;
        }
        .step {
            margin: 12px 0;
            display: flex;
            align-items: flex-start;
        }
        .step-number {
            background: #0066cc;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            margin-right: 12px;
            flex-shrink: 0;
        }
        .step-text {
            font-size: 14px;
            color: #333;
        }
        .landmark {
            color: #000000;
            font-weight: bold;
        }
        .shop-info {
            flex: 1;
            background: #f0f9f4;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #00A040;
        }
        .shop-info h3 {
            color: #00A040;
            margin: 0 0 15px 0;
            font-size: 18px;
            display: flex;
            align-items: center;
        }
        .shop-info h3::before {
            content: "ğŸ¢";
            margin-right: 8px;
            font-size: 20px;
        }
        .info-item {
            margin: 8px 0;
            font-size: 14px;
        }
        .info-label {
            font-weight: bold;
            color: #666;
            display: inline-block;
            width: 80px;
        }
        .alert-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #856404;
        }
        .alert-box h4 {
            margin: 0 0 10px 0;
            color: #856404;
            display: flex;
            align-items: center;
        }
        .alert-box h4::before {
            content: "âš ï¸";
            margin-right: 8px;
        }
        .static-map {
            position: relative;
            width: 100%;
            height: 100%;
        }
        .map-controls-overlay {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .map-control-btn {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            backdrop-filter: blur(5px);
        }
        .map-control-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .map-control-btn.primary {
            background: rgba(0, 102, 204, 0.95);
            color: white;
            border-color: #0066cc;
        }
        .map-control-btn.primary:hover {
            background: #0066cc;
        }
        .map-control-btn.secondary {
            background: rgba(230, 0, 18, 0.95);
            color: white;
            border-color: #e60012;
        }
        .map-control-btn.secondary:hover {
            background: #e60012;
        }
        .interactive-map {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .interactive-controls {
            display: flex;
            gap: 8px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 0 0 6px 6px;
            align-items: center;
            flex-wrap: wrap;
            flex-shrink: 0;
            min-height: 80px;
            overflow: visible;
        }
        .address-input {
            flex: 1;
            min-width: 150px;
            max-width: 200px;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }
        .address-input:focus {
            outline: none;
            border-color: #00A040;
            box-shadow: 0 0 0 2px rgba(0, 160, 64, 0.1);
        }
        .distance-time {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            margin: 15px 0;
            border: 1px solid #ddd;
        }
        .distance-time strong {
            color: #333333;
            font-size: 16px;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #666;
            font-size: 12px;
        }
        
        /* ã‚¹ãƒãƒ›å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        @media screen and (max-width: 768px) {
            .route-info {
                flex-direction: column;
                gap: 15px;
            }
            .route-steps,
            .shop-info {
                flex: none;
                width: 100%;
            }
            .interactive-controls {
                flex-direction: column;
                align-items: stretch;
                min-height: 200px;
                gap: 8px;
                padding: 15px;
                overflow: visible;
            }
            .map-control-btn {
                width: 100%;
                text-align: center;
                padding: 12px 16px;
                font-size: 14px;
                margin-bottom: 5px;
                box-sizing: border-box;
            }
            .address-input {
                width: 100%;
                max-width: none;
                margin-bottom: 8px;
                padding: 10px 12px;
                box-sizing: border-box;
            }
            .map-container {
                height: 480px;
            }
            #googleMap {
                height: 280px !important;
            }
            .interactive-map {
                height: 100%;
            }
        }
        
        @media print {
            .map-controls-overlay,
            .interactive-controls {
                display: none;
            }
            #interactiveMap {
                display: none !important;
            }
            #staticMap {
                display: block !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ç¦å±±é§…å‰åº— ã”æ¥åº—æ¡ˆå†…</h1>
            <p>JRç¦å±±é§…å—å£ã‹ã‚‰å¾’æ­©ç´„5åˆ†</p>
            <p>ã€’720-0066 åºƒå³¶çœŒç¦å±±å¸‚ä¸‰ä¹‹ä¸¸ç”º7-20</p>
        </div>

        <div class="distance-time">
            <strong>ğŸ“ JRç¦å±±é§…å—å£ â†’ ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ç¦å±±é§…å‰åº—</strong><br>
            <strong>å¾’æ­©ç´„5åˆ†ï¼ˆç´„400mï¼‰</strong>
        </div>

        <div class="map-container">
            <!-- Static Map (åˆæœŸè¡¨ç¤º) -->
            <div id="staticMap" class="static-map">
                <img id="staticMapImage" 
                     src="" 
                     alt="JRç¦å±±é§…ã‹ã‚‰ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ç¦å±±é§…å‰åº—ã¸ã®ãƒ«ãƒ¼ãƒˆãƒãƒƒãƒ—" 
                     style="width: 100%; height: 100%; object-fit: cover; border-radius: 6px;">
                
                <!-- Loading indicator -->
                <div id="mapLoading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255,255,255,0.9); padding: 20px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 18px; color: #00A040; margin-bottom: 10px;">ğŸ“</div>
                    <div style="color: #666;">æœ€é©ãªãƒ«ãƒ¼ãƒˆã‚’è¨ˆç®—ä¸­...</div>
                </div>
                
                <!-- Map Controls Overlay -->
                <div class="map-controls-overlay">
                    <button onclick="activateInteractiveMap()" class="map-control-btn primary">
                        ğŸ—ºï¸ ãƒãƒƒãƒ—ã‚’æ“ä½œã™ã‚‹
                    </button>
                    <button onclick="openGoogleMapsNavi()" class="map-control-btn secondary">
                        ğŸ“± ç¾åœ¨åœ°ã‹ã‚‰ãƒŠãƒ“
                    </button>
                </div>
            </div>

            <!-- Interactive Map (åˆ‡ã‚Šæ›¿ãˆå¾Œ) -->
            <div id="interactiveMap" class="interactive-map" style="display: none;">
                <div id="googleMap" style="width: 100%; height: 350px; border-radius: 6px 6px 0 0; flex-grow: 1;"></div>
                <div class="interactive-controls">
                    <button onclick="showStaticMap()" class="map-control-btn">
                        â† å…ƒã®è¡¨ç¤ºã«æˆ»ã‚‹
                    </button>
                    <input type="text" id="startAddress" placeholder="å‡ºç™ºåœ°ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šåºƒå³¶é§…ï¼‰" class="address-input">
                    <button onclick="calculateCustomRoute()" class="map-control-btn primary">
                        ğŸ” ãƒ«ãƒ¼ãƒˆæ¤œç´¢
                    </button>
                    <button onclick="openGoogleMapsNavi()" class="map-control-btn secondary">
                        ğŸ“± Googleãƒãƒƒãƒ—ã§é–‹ã
                    </button>
                </div>
            </div>
        </div>

        <div class="route-info">
            <div class="route-steps">
                <h3>å¾’æ­©ãƒ«ãƒ¼ãƒˆ</h3>
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-text">JRç¦å±±é§…<strong>å—å£</strong>ã‹ã‚‰å‡ºã‚‹</div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-text"><strong>å³æ–¹å‘</strong>ï¼ˆä¹å·æ–¹å‘ï¼‰ã«é€²ã‚€</div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-text"><span class="landmark">ãƒ€ã‚¤ãƒ¯ãƒ­ã‚¤ãƒãƒƒãƒˆãƒ›ãƒ†ãƒ«</span>ã®æ‰‹å‰ã¾ãŸã¯å¥¥ã§<strong>å·¦æŠ˜</strong>ã—ã¦è·¯åœ°ã¸å…¥ã‚‹</div>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <div class="step-text">çªãå½“ãŸã£ãŸã‚‰<strong>å³ã«æ›²ãŒã‚Š</strong>ç›´é€²</div>
                </div>
                <div class="step">
                    <div class="step-number">5</div>
                    <div class="step-text"><strong>å·¦æ‰‹</strong>ã«ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ç¦å±±é§…å‰åº—</div>
                </div>
            </div>

            <div class="shop-info">
                <h3>åº—èˆ—æƒ…å ±</h3>
                <div class="info-item">
                    <span class="info-label">åº—èˆ—åï¼š</span>ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ç¦å±±é§…å‰åº—
                </div>
                <div class="info-item">
                    <span class="info-label">ä½æ‰€ï¼š</span>ã€’720-0066<br>ã€€ã€€ã€€ã€€ã€€åºƒå³¶çœŒç¦å±±å¸‚ä¸‰ä¹‹ä¸¸ç”º7-20
                </div>
                <div class="info-item">
                    <span class="info-label">é›»è©±ï¼š</span>084-973-0100
                </div>
                <div class="info-item">
                    <span class="info-label">å–¶æ¥­æ™‚é–“ï¼š</span>8:00ï½20:00ï¼ˆå¹´ä¸­ç„¡ä¼‘ï¼‰
                </div>
                <div class="info-item">
                    <span class="info-label">å¾’æ­©æ™‚é–“ï¼š</span>JRç¦å±±é§…å—å£ã‹ã‚‰ç´„5åˆ†ï¼ˆç´„400mï¼‰
                </div>
            </div>
        </div>

        <div class="alert-box">
            <h4>ã”æ¥åº—æ™‚ã®ã”æ³¨æ„</h4>
            <p><strong>çœ‹æ¿ãŒè¦‹ãˆã«ãã„ç«‹åœ°ã®ãŸã‚ã€ä»¥ä¸‹ã‚’ã”æ´»ç”¨ãã ã•ã„ï¼š</strong></p>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li>ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®åœ°å›³ã‚¢ãƒ—ãƒªã¨ä½µç”¨ã—ã¦ãŠè¶Šã—ãã ã•ã„</li>
                <li>åº—èˆ—ã«è¿‘ã¥ã‘ã°ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ã®çœ‹æ¿ãŒè¦‹ãˆã¾ã™</li>
                <li>è¿·ã‚ã‚ŒãŸå ´åˆã¯åº—èˆ—ï¼ˆ084-973-0100ï¼‰ã¾ã§ãŠé›»è©±ãã ã•ã„</li>
            </ul>
        </div>

        <div class="footer">
            <p>ã“ã®ãƒãƒƒãƒ—ã¯æ¥åº—æ¡ˆå†…ç”¨ã§ã™ã€‚æœ€æ–°ã®å–¶æ¥­æ™‚é–“ç­‰ã¯åº—èˆ—ã«ã”ç¢ºèªãã ã•ã„ã€‚</p>
            <p>ãŠè»Šã§ãŠè¶Šã—ã®å ´åˆã¯ã€åº—èˆ—ã¾ã§ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</p>
        </div>
    </div>

    <!-- Google Maps JavaScript API -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAGUorGUfy--oERdupd_6FoUQc-xFR5WbE&libraries=geometry,places&callback=initMap"></script>
    
    <script>
        // åº—èˆ—ã®åº§æ¨™
        const SHOP_LOCATION = { lat: 34.4875, lng: 133.3601 };
        const STATION_LOCATION = { lat: 34.489004912054284, lng: 133.3624000319858 };
        
        let map;
        let directionsService;
        let directionsRenderer;

        // Google MapsåˆæœŸåŒ–
        function initMap() {
            // ãƒãƒƒãƒ—ä½œæˆï¼ˆåˆæœŸã¯éè¡¨ç¤ºï¼‰
            map = new google.maps.Map(document.getElementById('googleMap'), {
                zoom: 17,
                center: SHOP_LOCATION,
                mapTypeId: 'roadmap'
            });

            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({
                polylineOptions: {
                    strokeColor: '#0066cc',
                    strokeWeight: 4
                }
            });
            directionsRenderer.setMap(map);

            // é™çš„ãƒãƒƒãƒ—ç”¨ã®å®Ÿéš›ã®ãƒ«ãƒ¼ãƒˆã‚’å–å¾—
            generateStaticMapWithRoute();

            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒˆã‚’è¨­å®š
            calculateRoute(STATION_LOCATION, SHOP_LOCATION);
        }

        // å®Ÿéš›ã®å¾’æ­©ãƒ«ãƒ¼ãƒˆã‚’å–å¾—ã—ã¦é™çš„ãƒãƒƒãƒ—ã‚’ç”Ÿæˆ
        function generateStaticMapWithRoute() {
            const request = {
                origin: STATION_LOCATION,
                destination: SHOP_LOCATION,
                travelMode: google.maps.TravelMode.WALKING,
                unitSystem: google.maps.UnitSystem.METRIC,
                avoidHighways: false,
                avoidTolls: false
            };

            directionsService.route(request, (result, status) => {
                if (status === 'OK') {
                    console.log('Route calculation successful');
                    console.log('Full result structure:', result);
                    
                    const route = result.routes[0];
                    console.log('Route object:', route);
                    console.log('Overview polyline object:', route.overview_polyline);
                    
                    let encodedPath = null;
                    
                    // ã‚ˆã‚Šè©³ç´°ãªãƒãƒªãƒ©ã‚¤ãƒ³å–å¾—
                    if (route && route.overview_polyline && route.overview_polyline.points) {
                        encodedPath = route.overview_polyline.points;
                        console.log('Successfully got encoded polyline:', encodedPath.substring(0, 50) + '...');
                    } else {
                        console.log('Trying alternative polyline access methods...');
                        
                        // ä»£æ›¿æ‰‹æ®µ1: legs ã‹ã‚‰è©³ç´°ãƒã‚¤ãƒ³ãƒˆã‚’å–å¾—
                        if (route.legs && route.legs.length > 0) {
                            const steps = route.legs[0].steps;
                            const waypoints = [];
                            
                            steps.forEach(step => {
                                waypoints.push(`${step.start_location.lat()},${step.start_location.lng()}`);
                                waypoints.push(`${step.end_location.lat()},${step.end_location.lng()}`);
                            });
                            
                            encodedPath = waypoints.join('|');
                            console.log('Created waypoint path from steps:', waypoints.length, 'points');
                        } else {
                            console.log('No legs available, using manual path');
                            encodedPath = createEnhancedManualPath();
                        }
                    }
                    
                    // é™çš„ãƒãƒƒãƒ—URLã‚’æ§‹ç¯‰
                    const staticMapUrl = buildStaticMapUrl(encodedPath);
                    console.log('Final static map URL:', staticMapUrl);
                    
                    // é™çš„ãƒãƒƒãƒ—ã‚’æ›´æ–°
                    const mapImage = document.getElementById('staticMapImage');
                    const loadingDiv = document.getElementById('mapLoading');
                    
                    mapImage.onload = function() {
                        loadingDiv.style.display = 'none';
                        console.log('Static map loaded successfully with route');
                    };
                    
                    mapImage.onerror = function() {
                        console.error('Failed to load static map image');
                        showFallbackStaticMap();
                    };
                    
                    mapImage.src = staticMapUrl;
                } else {
                    console.error('Direction service failed with status:', status);
                    showFallbackStaticMap();
                }
            });
        }

        // ã‚ˆã‚Šè©³ç´°ãªæ‰‹å‹•ãƒ‘ã‚¹ä½œæˆ
        function createEnhancedManualPath() {
            // ç¦å±±é§…ã‹ã‚‰åº—èˆ—ã¾ã§ã®å®Ÿéš›ã®é“è·¯ã«æ²¿ã£ãŸæ¨å®šãƒ«ãƒ¼ãƒˆ
            const detailedPoints = [
                `${STATION_LOCATION.lat},${STATION_LOCATION.lng}`, // ç¦å±±é§…å—å£
                '34.4888,133.3620', // é§…å‰åºƒå ´
                '34.4886,133.3615', // å—ã¸é€²ã‚€
                '34.4884,133.3610', // ãƒ­ãƒ¼ã‚½ãƒ³æ‰‹å‰
                '34.4882,133.3608', // ãƒ­ãƒ¼ã‚½ãƒ³ä½ç½®ï¼ˆå³æŠ˜åœ°ç‚¹ï¼‰
                '34.4880,133.3605', // å³æŠ˜å¾Œ
                '34.4878,133.3603', // ç›´é€²
                `${SHOP_LOCATION.lat},${SHOP_LOCATION.lng}` // ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼
            ];
            
            console.log('Created enhanced manual path with', detailedPoints.length, 'points');
            return detailedPoints.join('|');
        }

        // é™çš„ãƒãƒƒãƒ—URLã‚’æ§‹ç¯‰
        function buildStaticMapUrl(pathData) {
            const baseUrl = 'https://maps.googleapis.com/maps/api/staticmap';
            const size = '600x400';
            const mapType = 'roadmap';
            const zoom = '16';
            const apiKey = 'AIzaSyAGUorGUfy--oERdupd_6FoUQc-xFR5WbE';
            
            // ãƒãƒ¼ã‚«ãƒ¼è¨­å®š - é§…ã¯é’ã€åº—èˆ—ã¯ãƒˆãƒ¨ã‚¿ã‚°ãƒªãƒ¼ãƒ³
            const startMarker = `markers=color:blue%7Clabel:S%7C${STATION_LOCATION.lat},${STATION_LOCATION.lng}`;
            const endMarker = `markers=color:0x00A040%7Clabel:G%7C${SHOP_LOCATION.lat},${SHOP_LOCATION.lng}`;
            
            // ãƒ‘ã‚¹è¨­å®š
            let pathParam;
            if (pathData && pathData.includes('|')) {
                // æ‰‹å‹•ãƒ‘ã‚¹ï¼ˆåº§æ¨™ãƒªã‚¹ãƒˆï¼‰
                pathParam = `path=color:0x0066ccff%7Cweight:5%7C${pathData}`;
            } else if (pathData) {
                // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒãƒªãƒ©ã‚¤ãƒ³
                pathParam = `path=color:0x0066ccff%7Cweight:5%7Cenc:${pathData}`;
            } else {
                // ç›´ç·šãƒ‘ã‚¹ï¼ˆæœ€çµ‚æ‰‹æ®µï¼‰
                pathParam = `path=color:0x0066ccff%7Cweight:5%7C${STATION_LOCATION.lat},${STATION_LOCATION.lng}%7C${SHOP_LOCATION.lat},${SHOP_LOCATION.lng}`;
            }
            
            const fullUrl = `${baseUrl}?size=${size}&maptype=${mapType}&zoom=${zoom}&${startMarker}&${endMarker}&${pathParam}&key=${apiKey}`;
            
            return fullUrl;
        }

        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã®é™çš„ãƒãƒƒãƒ—
        function showFallbackStaticMap() {
            const mapImage = document.getElementById('staticMapImage');
            const loadingDiv = document.getElementById('mapLoading');
            
            mapImage.src = `https://maps.googleapis.com/maps/api/staticmap?size=600x400&maptype=roadmap&markers=color:blue%7Clabel:S%7C${STATION_LOCATION.lat},${STATION_LOCATION.lng}&markers=color:0x00A040%7Clabel:G%7C${SHOP_LOCATION.lat},${SHOP_LOCATION.lng}&zoom=16&key=AIzaSyAGUorGUfy--oERdupd_6FoUQc-xFR5WbE`;
            
            loadingDiv.innerHTML = '<div style="color: #00A040;">ãƒãƒƒãƒ—ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
            setTimeout(() => {
                loadingDiv.style.display = 'none';
            }, 2000);
        }

        // ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒãƒ—ã‚’è¡¨ç¤º
        function activateInteractiveMap() {
            document.getElementById('staticMap').style.display = 'none';
            document.getElementById('interactiveMap').style.display = 'block';
            
            // ãƒãƒƒãƒ—ã‚µã‚¤ã‚ºèª¿æ•´
            setTimeout(() => {
                google.maps.event.trigger(map, 'resize');
                map.setCenter(SHOP_LOCATION);
            }, 100);
        }

        // é™çš„ãƒãƒƒãƒ—ã«æˆ»ã‚‹
        function showStaticMap() {
            document.getElementById('staticMap').style.display = 'block';
            document.getElementById('interactiveMap').style.display = 'none';
        }

        // ãƒ«ãƒ¼ãƒˆè¨ˆç®—
        function calculateRoute(start, end) {
            const request = {
                origin: start,
                destination: end,
                travelMode: google.maps.TravelMode.WALKING
            };

            directionsService.route(request, (result, status) => {
                if (status === 'OK') {
                    directionsRenderer.setDirections(result);
                } else {
                    console.error('ãƒ«ãƒ¼ãƒˆè¨ˆç®—ã‚¨ãƒ©ãƒ¼:', status);
                }
            });
        }

        // ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒˆæ¤œç´¢
        function calculateCustomRoute() {
            const startAddress = document.getElementById('startAddress').value;
            if (!startAddress.trim()) {
                alert('å‡ºç™ºåœ°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const geocoder = new google.maps.Geocoder();
            geocoder.geocode({ address: startAddress }, (results, status) => {
                if (status === 'OK') {
                    const startLocation = results[0].geometry.location;
                    calculateRoute(startLocation, SHOP_LOCATION);
                } else {
                    alert('ä½æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚æ­£ã—ã„ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                }
            });
        }

        // ç¾åœ¨åœ°å–å¾—ã—ã¦ãƒŠãƒ“é–‹å§‹
        function openGoogleMapsNavi() {
            // ã‚¹ãƒãƒ›ã§ã®ä½ç½®æƒ…å ±å–å¾—ã‚’æ”¹å–„
            if (navigator.geolocation) {
                // é«˜ç²¾åº¦ãªä½ç½®æƒ…å ±å–å¾—ã‚ªãƒ—ã‚·ãƒ§ãƒ³
                const geoOptions = {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                };
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        // ã‚¹ãƒãƒ›ç”¨ã®Googleãƒãƒƒãƒ—URLï¼ˆã‚ˆã‚Šç¢ºå®Ÿãªæ–¹æ³•ï¼‰
                        const googleMapsUrl = `https://www.google.com/maps/dir/?api=1&origin=${lat},${lng}&destination=${SHOP_LOCATION.lat},${SHOP_LOCATION.lng}&travelmode=walking`;
                        
                        console.log('Opening navigation with current location:', lat, lng);
                        
                        // ã‚¹ãƒãƒ›ã§ã‚¢ãƒ—ãƒªãŒé–‹ãã‚ˆã†ã«èª¿æ•´
                        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                            // ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã®å ´åˆ
                            window.location.href = googleMapsUrl;
                        } else {
                            // PCã®å ´åˆ
                            window.open(googleMapsUrl, '_blank');
                        }
                    },
                    (error) => {
                        console.error('Geolocation error:', error);
                        
                        // ç¾åœ¨åœ°å–å¾—å¤±æ•—æ™‚ã¯é§…ã‹ã‚‰ã®ãƒ«ãƒ¼ãƒˆã‚’è¡¨ç¤º
                        const fallbackUrl = `https://www.google.com/maps/dir/?api=1&origin=${STATION_LOCATION.lat},${STATION_LOCATION.lng}&destination=${SHOP_LOCATION.lat},${SHOP_LOCATION.lng}&travelmode=walking`;
                        
                        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
                        alert('ç¾åœ¨åœ°ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚é§…ã‹ã‚‰ã®ãƒ«ãƒ¼ãƒˆã‚’è¡¨ç¤ºã—ã¾ã™ã€‚');
                        
                        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                            window.location.href = fallbackUrl;
                        } else {
                            window.open(fallbackUrl, '_blank');
                        }
                    },
                    geoOptions
                );
            } else {
                console.log('Geolocation not supported');
                
                // ä½ç½®æƒ…å ±éå¯¾å¿œã®å ´åˆã¯é§…ã‹ã‚‰ã®ãƒ«ãƒ¼ãƒˆã‚’è¡¨ç¤º
                const fallbackUrl = `https://www.google.com/maps/dir/?api=1&origin=${STATION_LOCATION.lat},${STATION_LOCATION.lng}&destination=${SHOP_LOCATION.lat},${SHOP_LOCATION.lng}&travelmode=walking`;
                
                alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚é§…ã‹ã‚‰ã®ãƒ«ãƒ¼ãƒˆã‚’è¡¨ç¤ºã—ã¾ã™ã€‚');
                
                if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                    window.location.href = fallbackUrl;
                } else {
                    window.open(fallbackUrl, '_blank');
                }
            }
        }

        // å°åˆ·ç”¨ã«é™çš„ãƒãƒƒãƒ—ã‚’å¼·åˆ¶è¡¨ç¤º
        window.addEventListener('beforeprint', () => {
            showStaticMap();
        });
    </script>
</body>
</html>